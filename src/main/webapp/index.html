<!DOCTYPE html>
<!--[if IE 8]> 				 <html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->

    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width" />
        <title>Jygo </title>


        <link rel="stylesheet" href="css/foundation.css" />
        <link rel="stylesheet" href="css/main.css" />
        <link rel="stylesheet" href="css/jquery-ui-1.10.3.custom.min.css" />
        <link rel="stylesheet" href="http://code.jquery.com/qunit/qunit-1.11.0.css"/>
        <script src="js/vendor/custom.modernizr.js"></script>

    </head>
    <body >
        <nav class="top-bar" style="">
            <ul class="title-area">
                <!-- Title Area -->
                <li class="name">
                    <h1><a href="/">JyGo</a></h1>
                </li>
            </ul>


            <section class="top-bar-section">
                <!-- Right Nav Section -->
                <ul id="login_form" class="right">
                    <li class="divider"></li>
                    <li><input id="login" placeholder="Login"/></li>
                    <li class="divider"></li>
                    <li><input id="password" placeholder="Mot de passe"/></li>
                    <li class="divider"></li>
                    <li class="has-form">
                        <a class="button" href="#">Go</a>
                    </li>
                </ul>
            </section></nav>
        <div class="row">
            <div class="large-12 columns">
                <h2>Welcome to JyGo</h2>
                <p>This is version 0.0.0.1</p>
                <div id="options" style="display:none;">
                    <label for="minbeds">Nombre de cases : </label>
                    <select name="minbeds" id="minbeds" disabled="disabled">
                        <option>1</option>
                        <option>2</option>
                        <option>3</option>
                        <option>4</option>
                        <option>5</option>
                        <option>6</option>
                        <option>7</option>
                        <option>8</option>
                        <option>9</option>
                        <option selected="selected">10</option>
                        <option>11</option>
                        <option>12</option>
                        <option>13</option>
                        <option>14</option>
                        <option>15</option>
                        <option>16</option>
                        <option>17</option>
                        <option>18</option>
                        <option>19</option>
                    </select>
                    <div id="radio">
                        <input type="radio" id="radio2" name="radio" checked="checked" /><label for="radio2">Je commence</label>
                        <input type="radio" id="radio1" name="radio" /><label for="radio1">L'ordinateur commence</label>
                        
                    </div>
                    <a id="btn_launch_game" class="button" href="#">Launch game</a>

                    <hr />
                </div>
                <div id="launched_game">Your game is launched !</div>
            </div>
        </div>

        <div class="row">
            <div class="large-12 columns">
                <h3></h3>

                <!-- Grid Example -->
                <div class="row">
                    <div class="large-12 columns">
                        <div class="panel">
                            <table id="grille">

                                <tbody>
                                </tbody>
                            </table>
                            <table id="plateau">

                                <tbody>



                                </tbody>
                            </table>


                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="small-4 columns">
                        <div class="panel">
                            <p>Rules</p>
                        </div>
                    </div>
                    <div class="small-4 columns">
                        <div class="panel">
                            <p>demo</p>
                        </div>
                    </div>
                    <div class="small-4 columns">
                        <div class="panel">
                            <p>history</p>
                        </div>
                    </div>
                </div>



                <div class="row">
                    <div class="large-12 columns">
                        <h2 id="qunit-banner"></h2>
                        <div id="qunit-testrunner-toolbar">
                        </div>
                        <h2 id="qunit-userAgent"></h2>
                        <ol id="qunit-tests">
                        </ol>
                        <div id="qunit-fixture">
                            <div id="container"></div>
                        </div>
                    </div>

                </div>

            </div>


        </div>

        <script>
            document.write('<script src=' +
                    ('__proto__' in {} ? 'js/vendor/zepto' : 'js/vendor/jquery') +
                    '.js><\/script>');
        </script>
        <script type="text/javascript" src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
        <script type="text/javascript" src="js/jquery-ui-1.10.3.custom.min.js"></script>
        <script src="js/foundation.min.js"></script>
        <!--
        
        <script src="js/foundation/foundation.js"></script>
        
        <script src="js/foundation/foundation.dropdown.js"></script>
        
        <script src="js/foundation/foundation.placeholder.js"></script>
        
        <script src="js/foundation/foundation.forms.js"></script>
        
        <script src="js/foundation/foundation.alerts.js"></script>
        
        <script src="js/foundation/foundation.magellan.js"></script>
        
        <script src="js/foundation/foundation.reveal.js"></script>
        
        <script src="js/foundation/foundation.tooltips.js"></script>
        
        <script src="js/foundation/foundation.clearing.js"></script>
        
        <script src="js/foundation/foundation.cookie.js"></script>
        
        <script src="js/foundation/foundation.joyride.js"></script>
        
        <script src="js/foundation/foundation.orbit.js"></script>
        
        <script src="js/foundation/foundation.section.js"></script>
        
        <script src="js/foundation/foundation.topbar.js"></script>
        
        -->
        <script type="text/javascript" src="http://code.jquery.com/qunit/qunit-1.11.0.js"></script>

        <script  type="text/javascript" src="js/jygo.js"></script>
        <script  type="text/javascript" src="js/jygo.test.js"></script>
        <script>
            function generePlateau(nbr) {
                for (var i = 0; i < nbr; i++) {
                    $('#plateau tbody').append('<tr></tr>');
                    for (var j = 0; j < nbr; j++) {
                        $('#plateau tbody tr:last').append('<td></td>');
                    }

                }
                for (var i = 1; i < nbr; i++) {
                    $('#grille tbody').append('<tr></tr>');
                    for (var j = 1; j < nbr; j++) {
                        $('#grille tbody tr:last').append('<td></td>');
                    }

                }
            }
            function login(param) {
                $.ajax({
                    type: "POST",
                    url: "/jygo/webresources/go/login",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    data: JSON.stringify(param),
                    success: function(data, textStatus, jqXHR) {
                        id_Player = data.id;
                        $('#login_form').hide();
                        $("#options").show();
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        console.log(jqXHR);
                        console.log(textStatus);
                        console.log(errorThrown);
                    }
                });
            }
            function launch() {
                $.ajax({
                    type: "POST",
                    url: "/jygo/webresources/go/launch_game",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    data: "{\"id\": " + id_Player + ", \"cases\": " + $("#minbeds").val() + "}",
                    success: function(data, textStatus, jqXHR) {
                        generePlateau(parseInt($("#minbeds option:selected").html()));

                        $('#btn_launch_game').hide();
                        $("#options").hide();
                        $('#launched_game').show();

                        $("#plateau tr td").each(function() {
                            $(this).click(function() {

                                if ($(this).html() === "" && amoi === true) {
                                    amoi = false;
                                    var y = $(this).closest("td").index();
                                    var x = $(this).closest("tr").index();
                                    //alert("x=" + x + "y=" +y );
                                    $(this).append("<img src='img/p2.png' alt='img' />");
                                    play(x, y);
                                }
                                else if (amoi === false)
                                {
                                    alert("Ce nest pas Ã  vous de jouer");
                                }
                                else
                                {
                                    alert("deja present");
                                }

                            });
                        });
                    }
                });
            }
            function play(x, y) {
                $.ajax({
                    type: "POST",
                    url: "/jygo/webresources/go/command/",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    data: JSON.stringify({"id": id_Player, "x": x, "y": y}),
                    success: function(data) {
                        alert(data);
                        amoi = true;
                    }
                });
            }
        </script>
        <script>

            $(document).foundation();
            $( "#radio" ).buttonset();
            $('#launched_game').hide();
            var id_Player;
            var nbr = 19;
            var amoi = true;

            $(document).ready(function() {
                var select = $("#minbeds");
                var slider = $("<div id='slider'></div>").insertAfter(select).slider({
                    min: 1,
                    max: 19,
                    range: "min",
                    value: select[ 0 ].selectedIndex + 1,
                    slide: function(event, ui) {
                        select[ 0 ].selectedIndex = ui.value - 1;
                    }
                });
                $("#minbeds").change(function() {
                    slider.slider("value", this.selectedIndex + 1);
                });

                //binding
                $('.has-form').click(function() {

                    var list = {};
                    $('#login_form input').each(function() {
                        list[$(this).attr('id')] = ($(this).val());
                    });
                    login(list);
                });

                $('#btn_launch_game').click(function() {
                    launch();
                });




            });
        </script>
    </body>
</html>
